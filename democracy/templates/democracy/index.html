{% extends "base.html" %}
{% load googlecharts %}

{% block content %}

{% if user.is_authenticated %}
<div class="alert alert-success">You are authenticated as {{ user.username }} </div>
{% else %}
{% include "registration/login.html" with next="/democracy" %}
{% endif %}



<script type='text/javascript' src='https://www.google.com/jsapi'></script>
    <script type='text/javascript'>
     google.load('visualization', '1', {'packages': ['geochart']});
     google.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {
        var data = google.visualization.arrayToDataTable([
          ['Country', 'Popularity'],
          {% for c in orgs_by_countries %}
          ['{{ c.country }}', {{ c.country__count }}],
          {% endfor %}
        ]);

        var options = {};

        var chart = new google.visualization.GeoChart(document.getElementById('usr_geo'));
        chart.draw(data, options);
    };
</script>

<script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Sex', 'Count'],
          {% for g in users_by_sex %}
          ['{{ g.sex }}', {{ g.sex__count }}],
          {% endfor %}
        ]);

        var options = {
          title: 'Users by sex'
        };

        var chart = new google.visualization.PieChart(document.getElementById('sex_chart_div'));
        chart.draw(data, options);
      }
</script>

<div class="row">
<div class="span6">
<div id="usr_geo"></div>
<hr>
<div id="sex_chart_div"></div>
</div>

<div class="span6">
{% if most_popular_orgs_list%}
    <table class="table table-striped">
    	<tr>
    		<th>Org name:</th>
    		<th>Members:</th>
    		<th>With us since:</th>
    		<th>Country:</th>
    	</tr>
    {% for org in most_popular_orgs_list %}
    <tr>
        <td><a href="{% url 'org_detail' org.id %}">{{ org.name }}</a></td>
        <td>{{ org.num_member }}</td>
        <td>{{ org.date_created }}</td>
        <td><img src="{{ org.country.flag }}" alt="{{ org.country.name }}"></td>
    </tr>
    {% endfor %}
    </table>
{% else %}
    <p>Nothing :(</p>
{% endif %}
</div>
</div>


{% endblock %}